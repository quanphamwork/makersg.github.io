<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MakersG ‚Äî Flash Firmware ESP</title>

  <meta name="theme-color" content="#0f1720" />

  <!-- esp-web-tools -->
  <script type="module" src="https://unpkg.com/esp-web-tools@latest/dist/web/install-button.js"></script>

  <link rel="icon" href="assets/favicon.ico" />

  <style>
    :root {
      --bg: #0b0f12; --surface: #0f1417; --muted: #9aa6b2; --text: #e6eef6;
      --brand-accent: #58a6ff; --brand-strong: #cfe9ff;
      --radius: 12px; --glass: rgba(255,255,255,0.03);
      --shadow: 0 10px 30px rgba(2,6,23,0.4);
    }
    :root[data-theme='light'] {
      --bg: #fafbfc; --surface: #fff; --muted: #556677; --text: #091023;
      --brand-accent: #0a84ff; --brand-strong: #0f7fff;
      --shadow: 0 10px 30px rgba(11,18,32,0.12);
    }

    /* Global */
    body {
      margin: 0; background: var(--bg);
      background-image: linear-gradient(180deg, rgba(88,166,255,0.02), transparent);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, sans-serif;
    }
    .wrap { max-width: 960px; margin: 36px auto; padding: 20px; }
    .flex { display: flex; align-items: center; }
    .gap { gap: 12px; }

    /* HEADER */
    header.brand { justify-content: space-between; margin-bottom: 20px; }
    .brand-logo {
      width: 56px; height: 56px; padding: 8px;
      background: var(--glass); border-radius: 10px; display: grid; place-items: center;
    }
    .brand-logo img { width: 100%; object-fit: contain; }
    .btn-plain {
      background: none; border: 0; color: var(--muted); border-radius: 8px;
      padding: 8px; cursor: pointer; transition: 0.2s;
    }
    .btn-plain:hover { color: var(--brand-accent); transform: translateY(-1px); }

    /* CARD */
    .card {
      background: var(--surface);
      border: 1px solid rgba(255,255,255,0.03);
      box-shadow: var(--shadow);
      padding: 22px; border-radius: 14px;
    }
    .grid {
      display: grid; grid-template-columns: 1fr 340px; gap: 20px;
    }

    /* LEFT */
    .install-wrap {
      padding: 20px; border-radius: 12px;
      background: var(--surface); border: 1px solid rgba(255,255,255,0.04);
      display: flex; justify-content: center;
    }
    .selector { display: flex; gap: 10px; flex-wrap: wrap; }
    .version-select {
      padding: 10px 12px; border-radius: 10px;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.03);
      color: var(--text); font-weight: 600;
    }
    .apply-btn {
      background: var(--brand-accent); color: #fff; border: 0;
      padding: 10px 16px; border-radius: 10px; cursor: pointer;
      font-weight: 700; box-shadow: 0 4px 14px rgba(46,160,255,0.18);
    }

    /* RIGHT */
    .meta, .help {
      background: var(--surface);
      border-radius: 10px; padding: 12px;
      border: 1px solid rgba(255,255,255,0.04);
      font-size: 14px; color: var(--muted);
    }
    .help { background: transparent; border: none; }

    footer { margin-top: 20px; color: var(--muted); font-size: 13px; }

    @media (max-width: 880px) {
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- HEADER -->
    <header class="brand flex">
      <div class="flex gap">
        <div class="brand-logo">
          <img src="assets/makersg-logo.png" alt="MakersG logo" />
        </div>
        <div>
          <h1 style="margin:0;font-size:18px;color:var(--brand-strong)">MakersG</h1>
          <p style="margin:0;font-size:13px;color:var(--muted)">ESP Firmware Manager ‚Äî N·∫°p nhanh, an to√†n</p>
        </div>
      </div>

      <div class="flex gap">
        <a class="btn-plain" target="_blank" href="https://github.com/quanphamwork/makersg.github.io">Repo</a>
        <button id="themeToggle" class="btn-plain" aria-pressed="false">
          <span id="themeIcon">üåô</span>
        </button>
      </div>
    </header>

    <!-- MAIN -->
    <div class="card">
      <div class="grid">
        <!-- LEFT -->
        <div>
          <div class="selector">
            <label style="color:var(--muted)">Phi√™n b·∫£n:</label>
            <select id="versionSelect" class="version-select"></select>
            <button id="applyBtn" class="apply-btn">√Åp d·ª•ng</button>
          </div>

          <div id="installerArea" class="install-wrap"></div>

          <div class="meta" id="firmwareMeta"></div>
        </div>

        <!-- RIGHT -->
        <div class="flex" style="flex-direction:column;gap:12px">
          <div class="meta">
            <strong>H∆∞·ªõng d·∫´n nhanh</strong>
            <ul style="margin:8px 0 0 18px;">
              <li>K·∫øt n·ªëi ESP qua USB.</li>
              <li>Ch·ªçn phi√™n b·∫£n ‚Üí <b>√Åp d·ª•ng</b> ‚Üí "Install".</li>
              <li>Firmware c·∫ßn host HTTPS + CORS.</li>
            </ul>
          </div>

          <div class="help">
            <strong>L∆∞u √Ω k·ªπ thu·∫≠t</strong>
            <p style="margin:8px 0 0">
              T√≠nh SHA256 b·∫±ng: <code>shasum -a 256 firmware.bin</code>
            </p>
          </div>
        </div>
      </div>

      <footer class="flex" style="justify-content:space-between">
        <span>¬© MakersG ‚Äî Dark mode first</span>
        <a href="#" style="color:var(--muted)">Ch√≠nh s√°ch</a>
      </footer>
    </div>
  </div>

  <script>
    /* ===========================
       CONFIG FIRMWARE
    ============================ */
    const firmwares = [
      {
        label: "v1.2.0 ‚Äî Stable",
        url: "https://your-domain/esp-firmware-v1.2.0.bin",
        version: "1.2.0",
        board: "esp32",
        sha256: "REPLACE_SHA256_120",
        notes: "S·ª≠a l·ªói Wi-Fi, tƒÉng ·ªïn ƒë·ªãnh",
        offset: "0x1000"
      },
      {
        label: "v1.1.0 ‚Äî Beta",
        url: "https://your-domain/esp-firmware-v1.1.0.bin",
        version: "1.1.0",
        board: "esp32",
        sha256: "REPLACE_SHA256_110",
        notes: "T√≠nh nƒÉng th·ª≠ nghi·ªám",
        offset: "0x1000"
      },
      {
        label: "v1.0.0 ‚Äî Legacy",
        url: "https://your-domain/esp-firmware-v1.0.0.bin",
        version: "1.0.0",
        board: "esp32",
        sha256: "REPLACE_SHA256_100",
        notes: "Phi√™n b·∫£n ƒë·∫ßu ti√™n",
        offset: "0x1000"
      }
    ];

    /* ===========================
       DOM
    ============================ */
    const selectEl = document.getElementById("versionSelect");
    const installerArea = document.getElementById("installerArea");
    const firmwareMeta = document.getElementById("firmwareMeta");
    const applyBtn = document.getElementById("applyBtn");

    let manifestUrl = null;

    /* ===========================
       INIT SELECT
    ============================ */
    firmwares.forEach((fw, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = fw.label;
      selectEl.appendChild(opt);
    });

    /* ===========================
       CREATE MANIFEST
    ============================ */
    function createManifest(fw) {
      const data = {
        name: "MakersG Firmware",
        version: fw.version,
        description: fw.notes,
        firmwares: [{
          url: fw.url,
          board: fw.board,
          version: fw.version,
          sha256: fw.sha256,
          offset: fw.offset
        }]
      };

      if (manifestUrl) URL.revokeObjectURL(manifestUrl);
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
      manifestUrl = URL.createObjectURL(blob);
      return manifestUrl;
    }

    /* ===========================
       APPLY SELECTION
    ============================ */
    function applySelection() {
      const fw = firmwares[selectEl.value];
      const url = createManifest(fw);

      installerArea.innerHTML = "";
      const el = document.createElement("esp-web-install-button");
      el.setAttribute("manifest", url);
      installerArea.appendChild(el);

      firmwareMeta.innerHTML =
        `<b>${fw.label}</b><br/><small>${fw.notes}</small><br/>SHA256: ${fw.sha256.slice(0,12)}‚Ä¶`;
    }

    applyBtn.onclick = applySelection;
    applySelection();

    /* ===========================
       THEME TOGGLE
    ============================ */
    const toggle = document.getElementById("themeToggle");
    const icon = document.getElementById("themeIcon");
    const html = document.documentElement;

    function setTheme(dark) {
      html.dataset.theme = dark ? "" : "light";
      icon.textContent = dark ? "‚òÄÔ∏è" : "üåô";
      toggle.ariaPressed = dark;
      localStorage.setItem("theme", dark ? "dark" : "light");
    }

    const saved = localStorage.getItem("theme");
    const darkStart = saved === "dark" || (!saved && matchMedia("(prefers-color-scheme: dark)").matches);
    setTheme(darkStart);

    toggle.onclick = () => setTheme(html.dataset.theme === "light");
  </script>
</body>
</html>
